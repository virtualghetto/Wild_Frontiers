#textdomain wesnoth-Wild_Frontiers
[scenario]
    id=A_New_Beginning
    next_scenario=Summer_of_Dreams
    name=_"A New Beginning"
    turns={SEASON_LENGTH}
    victory_when_enemies_defeated=no

    {DEFAULT_SCHEDULE}

    {DEFAULT_MUSIC_PLAYLIST}

    {GENERATE_MAP}

    # Apply map mask if it exists
#ifhave ~add-ons/Wild_Frontiers/maps/WF_map.mask
    [event]
        name=prestart
        [terrain_mask]
            x,y=1,1
            border=yes
            mask="{~add-ons/Wild_Frontiers/maps/WF_map.mask}"
        [/terrain_mask]
    [/event]
#endif

    {BEGINNING_STORY}

    [event]
        name=prestart

        # ----- Set up Campaign ------------------------------------------
        # These control enemy characteristics. See game_parameters.cfg
        {SETUP_GAME_VARIABLES}

        # ----- Season-specific initialize ----------------------------------
        # SETUP_SEASON_VARIABLES takes over in later seasons
        # What season # is it? Enemies get stronger and other effects occur
        # as the years go on. Starts at zero.
        {SETUP_SEASON_VARIABLES spring _"Spring"}	# season +1 done here
        {VARIABLE wf_vars.next_scenario Summer_of_Dreams}
    [/event]

    {YOU_ARE_SIDE1 no}
    {ANIMALS_ARE_SIDE2 0}
    {NICE_OUTLAWS_ARE_SIDE3}
    {MEAN_OUTLAWS_ARE_SIDE4}
    {ORCS_ARE_SIDE5}	# not actually present, but sides must be defined in order
    {ELVES_ARE_SIDE6}
    {UNDEAD_ARE_SIDE7}
    {CALAMITY_IS_SIDE8}
    {FRIENDS_ARE_SIDE9}

    {NEW_OUTLAWS_RAIDS $jumps.spring_outlaws LIMIT=2}
    {NEW_ORC_AND_UNDEAD_RAIDS $jumps.spring_raids LIMIT=-1} # No raids in first spring
    {NEW_ELVES_RAIDS LIMIT=0} # Raid on hard only
    {NEW_DWARVES_RAIDS LIMIT=0} # Raid on hard only

    # ----- Prestart -----------------------------------------------------
    [event]
        name=prestart

        # ----- Set up Campaign ------------------------------------------

        # Determine where signposts are on each map edge
        [set_variable]
            name=center_x
            ipart="$({MAP_WIDTH}/2.0)"
        [/set_variable]
        [set_variable]
            name=center_y
            ipart="$({MAP_HEIGHT}/2.0)"
        [/set_variable]
        # East, North, West, South in order
        {FIND_SIGN_SITE_NEAR {MAP_WIDTH} $center_y y}
        {FIND_SIGN_SITE_NEAR $center_x 1 x}
        {FIND_SIGN_SITE_NEAR 1 $center_y y}
        {FIND_SIGN_SITE_NEAR $center_x {MAP_HEIGHT} x}

        # Relics (the latter macro should be in all scenarios)
        {SELECT_RELICS}
        {SET_UP_RELICS}

        # Place the hero and his sidekicks -- can't be done in the [side] tage
        # because I need to make sure you don't get placed on top of a mountain
        # or something by playing with variables.

        # Pick a starting location and put the hero and lackeys there
        {FIND_NEAREST_HEX center_plains $center_x $center_y (
            terrain=G*,R*
            [filter_adjacent_location]
                terrain=G*,R*
                count=3-6
            [/filter_adjacent_location]
        )}

        # I use the temporary leader to maintain consistency of leader id with
        # the later scenarios, thereby keeping the recall list intact. The
        # temporary leader is required in later scenarios to avoid problems
        # with the unstoring of units.
        [unit]
            canrecruit=yes
            name=_"Ã†lfric"
            unrenamable=yes
            gender=male
            id=Hero
            passable=yes
            placement=map
            random_traits=no
            side=1
            type=Sergeant
            x=$center_plains.x
            y=$center_plains.y
            [modifications]
                {TRAIT_QUICK}
                {TRAIT_STRONG}
            [/modifications]
        [/unit]
        {CLEAR_VARIABLE center_x}
        {CLEAR_VARIABLE center_y}

        [unit]
            id=loyal_swordsman
            passable=yes
            placement=leader
            random_traits=no
            role=advisor
            name=_"The Advisor"
            side=1
            type=Swordsman
            [modifications]
                {TRAIT_LOYAL}
                {TRAIT_FEARLESS}
            [/modifications]
            {IS_LOYAL}
        [/unit]
        [unit]
            id=loyal_cavalry
            passable=yes
            placement=leader
            random_traits=no
            role=cynic
            name=_"The Cynic"
            side=1
            type=Cavalryman
            [modifications]
                {TRAIT_LOYAL}
                {TRAIT_RESILIENT}
            [/modifications]
            {IS_LOYAL}
        [/unit]
        [unit]
            id=loyal_bowman
            passable=yes
            placement=leader
            random_traits=no
            role=fool
            name=_"The Fool"
            facing=se
            side=1
            type=Bowman
            [modifications]
                {TRAIT_LOYAL}
                {TRAIT_QUICK}
            [/modifications]
            {IS_LOYAL}
        [/unit]
        # Give initial campaign gold
        [gold]
            side=1
            {STARTING_GOLD}
        [/gold]

        # Store leader's name, perhaps used in dialogue
        [store_unit]
            variable=leader_store
            [filter]
                id=Hero
            [/filter]
        [/store_unit]
        {VARIABLE wf_vars.hero_name $leader_store.name}
        {CLEAR_VARIABLE leader_store}

        # ----- Scenario-specific stuff ----------------------------------

        # Farms produce a few crops in the spring
        {VARIABLE farm_income.spring 1}
        {VARIABLE farm_support.spring 1}
        [modify_side]
            side=1
            village_gold=$farm_income.spring
            village_support=$farm_support.spring
        [/modify_side]

        # Workers can build and alter terrain, can't move while working
        {WORKERS_CAN_WORK}

        # Un-recruit units to your recall list
        {ALLOW_UNRECRUIT}

        # Assign speaker roles on recruiting
        {ASSIGN_SPEAKER_ROLES}

        # Signposts
        {SET_MAP_SIGNS}

        # Fewer outlaws to start with (add more at end)
        {VARIABLE_OP enemy.num_outlaws sub 1}

        # Place random animals in the area
        #{REPEAT $enemy.num_animals {FIRE_EVENT new_random_animal}}

        {VARIABLE repeat_count $enemy.num_animals}
        {VARIABLE_OP repeat_count divide 2}
        {VARIABLE_OP repeat_count round floor}
        {SCATTER_UNITS $repeat_count {ANIMALS_SCATTER_LIST} 1 (
            terrain=!,*^V*,!,*^F*,H*^*,M*^*
            {X_AND_Y_ARE_ON_THE_MAP}
            {NOT_FILTER}
            {NOT_FILTER_ADJACENT}
        ) (
            side=2
            placement=map
            passable=yes
            generate_name=yes
            random_gender=yes
            random_traits=yes
            {MOD_OBJECT_LOYAL}
        )}
        {CLEAR_VARIABLE repeat_count}

        # But reduce or weaken those near the player
        [store_unit]
            variable=beast_list
            kill=yes
            [filter]
                side=2
                [filter_location]
                    x,y=$center_plains.x,$center_plains.y
                    radius=12
                [/filter_location]
            [/filter]
        [/store_unit]
        [if]
            {VARIABLE_CONDITIONAL beast_list.length greater_than 4}
            [then]
                {VARIABLE allowed_animals 4}
            [/then]
            [else]
                {VARIABLE allowed_animals $beast_list.length}
            [/else]
        [/if]
        {VARIABLE i 0}
        [while]
            {VARIABLE_CONDITIONAL i less_than $allowed_animals}
            [do]
                [switch]
                    variable=beast_list[$i].type
                    [case]
                        value="Wolf,Young Ogre,WF_Tusker,Wose"
                        [unit]
                            random_traits=yes
                            side=2
                            type="Rabbit"
                            x=$beast_list[$i].x
                            y=$beast_list[$i].y
                            {MOD_OBJECT_LOYAL}
                        [/unit]
                    [/case]
                    # "Extra" units or other types are simply killed off
                [/switch]
                {VARIABLE_OP i add 1}
            [/do]
        [/while]
        {CLEAR_VARIABLE center_plains,beast_list,allowed_animals,i}

        {ALLOW_RECRUIT "Peasant Workers,Peasant_no_Advance,Woodsman_no_Advance,Ruffian_no_Advance"}
        [event]
            name=build_keep_event
            id=build_keep_event
            first_time_only=no

            [if]
                [and]
                    [have_location]
                        terrain={BUILDABLE_TERRAIN}
                        x,y=$weapon.x,$weapon.y
                    [/have_location]
                    [have_location]
                        terrain={BUILDABLE_TERRAIN}
                        x,y=$weapon.fort_x,$weapon.fort_y
                        include_borders=no
                    [/have_location]
                [/and]
                [then]
                    {BUILD_KEEP_1}
                    [message]
                        {BUILD_KEEP_2}
                        [text_input]
                            label=_"Name:"
                            variable=town_name
                            text=$wf_vars.hero_name
                            max_length=16
                        [/text_input]
                    [/message]
                    [if]
                        {VARIABLE_CONDITIONAL town_name equals $wf_vars.hero_name}
                        [then]
                            {BUILD_KEEP_3}
                        [/then]
                    [/if]
                    {MODIFY_UNIT id=Hero moves 0}
                    {MODIFY_TERRAIN "Ke^Yk" $weapon.x $weapon.y}
                    {MODIFY_TERRAIN "Ce" $weapon.fort_x $weapon.fort_y}
                    {BUILD_KEEP_4}
                    {STANDARD_OBJECTIVES spring}
                    {BUILD_KEEP_5}
                    [if]
                        {VARIABLE_CONDITIONAL town_name not_equals ""}
                        [then]
                            {VARIABLE wf_vars.town_name $town_name}
                            {ADD_MAP_LABEL $weapon.x $weapon.y $town_name}
                        [/then]
                        [else]
                            {VARIABLE wf_vars.town_name _"Town center"}
                            {ADD_MAP_LABEL $weapon.x $weapon.y _"Town center"}
                        [/else]
                    [/if]
                    {CLEAR_VARIABLE town_name}
                    [clear_menu_item]
                        id=relocate_keep_hero
                    [/clear_menu_item]
                    # kill "build keep" menu item for all later scenarios
                    [clear_menu_item]
                        id=build_keep_hero
                    [/clear_menu_item]
                    [remove_event]
                        id=build_keep_event
                    [/remove_event]
                [/then]
                [else]
                    [if]
                        [and]
                            {HAVE_ADVISOR}
                            {HAVE_CYNIC}
                        [/and]
                        [then]
                            {BUILD_KEEP_FAIL_1}
                        [/then]
                    [/if]
                    {BUILD_KEEP_FAIL_2}
                [/else]
            [/if]
        [/event]

        # Allow the hero to build a keep
        [set_menu_item]
            id=build_keep_hero
            description=_ "Build your keep here"
            image="tent_icon.png"
            [show_if]
                [and]
                    [have_location]
                        terrain=Ke^Yk
                        count=0
                    [/have_location]
                    [have_unit]
                        id=Hero
                        x=$x1
                        y=$y1
                    [/have_unit]
                [/and]
            [/show_if]
            [command]
                [set_variable]
                    name=even_odd
                    value="$($x1 % 2)"
                [/set_variable]
                [if]
                    {VARIABLE_CONDITIONAL even_odd equals 1}
                    [then]
                        # $x1 is Odd
                        [message]
                            speaker=Hero
                            message=_"In what direction should I place the fort?"
                            [option]
                                label=_"North"
                                image = "terrain/castle/encampment/regular-tile.png~SCALE(36,36)"
                                [command]
                                    [fire_event]
                                        name=build_keep_event
                                        [primary_unit]
                                            x,y=$x1,$y1
                                        [/primary_unit]
                                        [primary_attack]
                                            fort_x=$x1
                                            fort_y="$($y1-1)"
                                            x=$x1
                                            y=$y1
                                        [/primary_attack]
                                    [/fire_event]
                                [/command]
                            [/option]
                            [option]
                                label=_"North-East"
                                image = "terrain/castle/encampment/regular-tile.png~SCALE(36,36)"
                                [command]
                                    [fire_event]
                                        name=build_keep_event
                                        [primary_unit]
                                            x,y=$x1,$y1
                                        [/primary_unit]
                                        [primary_attack]
                                            fort_x="$($x1+1)"
                                            fort_y="$($y1-1)"
                                            x=$x1
                                            y=$y1
                                        [/primary_attack]
                                    [/fire_event]
                                [/command]
                            [/option]
                            [option]
                                label=_"North-West"
                                image = "terrain/castle/encampment/regular-tile.png~SCALE(36,36)"
                                [command]
                                    [fire_event]
                                        name=build_keep_event
                                        [primary_unit]
                                            x,y=$x1,$y1
                                        [/primary_unit]
                                        [primary_attack]
                                            fort_x="$($x1-1)"
                                            fort_y="$($y1-1)"
                                            x=$x1
                                            y=$y1
                                        [/primary_attack]
                                    [/fire_event]
                                [/command]
                            [/option]
                            [option]
                                label=_"South"
                                image = "terrain/castle/encampment/regular-tile.png~SCALE(36,36)"
                                [command]
                                    [fire_event]
                                        name=build_keep_event
                                        [primary_unit]
                                            x,y=$x1,$y1
                                        [/primary_unit]
                                        [primary_attack]
                                            fort_x=$x1
                                            fort_y="$($y1+1)"
                                            x=$x1
                                            y=$y1
                                        [/primary_attack]
                                    [/fire_event]
                                [/command]
                            [/option]
                            [option]
                                label=_"South-East"
                                image = "terrain/castle/encampment/regular-tile.png~SCALE(36,36)"
                                [command]
                                    [fire_event]
                                        name=build_keep_event
                                        [primary_unit]
                                            x,y=$x1,$y1
                                        [/primary_unit]
                                        [primary_attack]
                                            fort_x="$($x1+1)"
                                            fort_y=$y1
                                            x=$x1
                                            y=$y1
                                        [/primary_attack]
                                    [/fire_event]
                                [/command]
                            [/option]
                            [option]
                                label=_"South-West"
                                image = "terrain/castle/encampment/regular-tile.png~SCALE(36,36)"
                                [command]
                                    [fire_event]
                                        name=build_keep_event
                                        [primary_unit]
                                            x,y=$x1,$y1
                                        [/primary_unit]
                                        [primary_attack]
                                            fort_x="$($x1-1)"
                                            fort_y=$y1
                                            x=$x1
                                            y=$y1
                                        [/primary_attack]
                                    [/fire_event]
                                [/command]
                            [/option]
                            [option]
                                label=_"Nevermind, I'll set it up elsewhere."
                                image = "terrain/void/void.png~SCALE(36,36)"
                                [command]
                                [/command]
                            [/option]
                        [/message]
                    [/then]
                    [else]
                        # $x1 is Even
                        [message]
                            speaker=Hero
                            message=_"In what direction should I place the fort?"
                            [option]
                                label=_"North"
                                image = "terrain/castle/encampment/regular-tile.png~SCALE(36,36)"
                                [command]
                                    [fire_event]
                                        name=build_keep_event
                                        [primary_unit]
                                            x,y=$x1,$y1
                                        [/primary_unit]
                                        [primary_attack]
                                            fort_x=$x1
                                            fort_y="$($y1-1)"
                                            x=$x1
                                            y=$y1
                                        [/primary_attack]
                                    [/fire_event]
                                [/command]
                            [/option]
                            [option]
                                label=_"North-East"
                                image = "terrain/castle/encampment/regular-tile.png~SCALE(36,36)"
                                [command]
                                    [fire_event]
                                        name=build_keep_event
                                        [primary_unit]
                                            x,y=$x1,$y1
                                        [/primary_unit]
                                        [primary_attack]
                                            fort_x="$($x1+1)"
                                            fort_y=$y1
                                            x=$x1
                                            y=$y1
                                        [/primary_attack]
                                    [/fire_event]
                                [/command]
                            [/option]
                            [option]
                                label=_"North-West"
                                image = "terrain/castle/encampment/regular-tile.png~SCALE(36,36)"
                                [command]
                                    [fire_event]
                                        name=build_keep_event
                                        [primary_unit]
                                            x,y=$x1,$y1
                                        [/primary_unit]
                                        [primary_attack]
                                            fort_x="$($x1-1)"
                                            fort_y=$y1
                                            x=$x1
                                            y=$y1
                                        [/primary_attack]
                                    [/fire_event]
                                [/command]
                            [/option]
                            [option]
                                label=_"South"
                                image = "terrain/castle/encampment/regular-tile.png~SCALE(36,36)"
                                [command]
                                    [fire_event]
                                        name=build_keep_event
                                        [primary_unit]
                                            x,y=$x1,$y1
                                        [/primary_unit]
                                        [primary_attack]
                                            fort_x=$x1
                                            fort_y="$($y1+1)"
                                            x=$x1
                                            y=$y1
                                        [/primary_attack]
                                    [/fire_event]
                                [/command]
                            [/option]
                            [option]
                                label=_"South-East"
                                image = "terrain/castle/encampment/regular-tile.png~SCALE(36,36)"
                                [command]
                                    [fire_event]
                                        name=build_keep_event
                                        [primary_unit]
                                            x,y=$x1,$y1
                                        [/primary_unit]
                                        [primary_attack]
                                            fort_x="$($x1+1)"
                                            fort_y="$($y1+1)"
                                            x=$x1
                                            y=$y1
                                        [/primary_attack]
                                    [/fire_event]
                                [/command]
                            [/option]
                            [option]
                                label=_"South-West"
                                image = "terrain/castle/encampment/regular-tile.png~SCALE(36,36)"
                                [command]
                                    [fire_event]
                                        name=build_keep_event
                                        [primary_unit]
                                            x,y=$x1,$y1
                                        [/primary_unit]
                                        [primary_attack]
                                            fort_x="$($x1-1)"
                                            fort_y="$($y1+1)"
                                            x=$x1
                                            y=$y1
                                        [/primary_attack]
                                    [/fire_event]
                                [/command]
                            [/option]
                            [option]
                                label=_"Nevermind, I'll set it up elsewhere."
                                image = "terrain/void/void.png~SCALE(36,36)"
                                [command]
                                [/command]
                            [/option]
                        [/message]
                    [/else]
                [/if]
                {CLEAR_VARIABLE even_odd}
            [/command]
        [/set_menu_item]
        [capture_village]
            side=1
            terrain=*^V*,*^Ygy
        [/capture_village]
        {SURPRISE_TENT RND="friend"}
        {SETUP_NEXT_URM}
        {URM_TENT}
        {URM_STATUE}
    [/event]

    # ----- Start --------------------------------------------------------
    # Start: Intro dialog and tutorial
    [event]
        name=start

#ifdef HARD
        {VARIABLE_OP quota.outlaws sub 1}
#endif

        # For library report. Remove excess events.
        {VARIABLE quota.orc_raids 0}
        {VARIABLE relations.orc_raids 0}
        #{REMOVE_EVENT new_orc_raid}
        {REMOVE_EVENT spawn_side_5}
        {VARIABLE quota.undead_raids 0}
        {VARIABLE relations.undead_raids 0}
        #{REMOVE_EVENT new_undead_raid}
        {REMOVE_EVENT spawn_side_7}

        {GREETING_DELFADOR}
        {VARIABLE tutorial.messages yes}

        {WF_SCROLL_UNIT (id=Hero)}

        {INITIAL_DIALOGUE}

        {VARIABLE v_bonus_funds no}
        {VARIABLE v_bonus_followers no}
        {VARIABLE v_bonus_workers no}
        {VARIABLE v_bonus_guardian no}
        {VARIABLE v_bonus_mage no}
        {VARIABLE v_bonus_prisoner no}
        {VARIABLE v_bonus_artifact no}
        {VARIABLE v_bonus_termites no}
        {VARIABLE v_bonus_treatises no}
        {VARIABLE v_bonus_finance no}
        {VARIABLE v_bonus_fungi no}
        {VARIABLE v_bonus_maps no}
        {VARIABLE v_bonus_fortifications no}
        {VARIABLE v_bonus_tunnels no}

        [set_variable]
            name=selected_options
            {QUANTITY value 4 3 2}
        [/set_variable]

        {ADVISOR_SAYS _"Before we get started, your father has sent you $selected_options| things that you might find very useful."}

        [while]
            {VARIABLE_CONDITIONAL selected_options greater_than 0}
            [do]
                [message]
                    speaker=Hero
                    message=_"Oh, didn't he say something about..."
                    [option]
                        label=_"some loyal followers? (Free)"
                        [show_if]
                            {VARIABLE_CONDITIONAL v_bonus_followers boolean_equals no}
                        [/show_if]
                        [command]
                            {FIRE_EVENT bonus_followers}
                            {VARIABLE v_bonus_followers yes}
                            #{VARIABLE_OP selected_options sub 1}
                        [/command]
                    [/option]
                    [option]
                        label=_"a prisoner? (Free)"
                        [show_if]
                            {VARIABLE_CONDITIONAL v_bonus_prisoner boolean_equals no}
                        [/show_if]
                        [command]
                            {FIRE_EVENT bonus_prisoner}
                            {VARIABLE v_bonus_prisoner yes}
                            #{VARIABLE_OP selected_options sub 1}
                        [/command]
                    [/option]
                    [option]
                        label=_"some loyal workers?"
                        [show_if]
                            {VARIABLE_CONDITIONAL v_bonus_workers boolean_equals no}
                        [/show_if]
                        [command]
                            {FIRE_EVENT bonus_workers}
                            {VARIABLE v_bonus_workers yes}
                            {VARIABLE_OP selected_options sub 1}
                        [/command]
                    [/option]
                    [option]
                        label=_"some strong guardians?"
                        [show_if]
                            {VARIABLE_CONDITIONAL v_bonus_guardian boolean_equals no}
                        [/show_if]
                        [command]
                            {FIRE_EVENT bonus_guardian}
                            {VARIABLE v_bonus_guardian yes}
                            {VARIABLE_OP selected_options sub 1}
                        [/command]
                    [/option]
                    [option]
                        label=_"a powerful mage?"
                        [show_if]
                            {VARIABLE_CONDITIONAL v_bonus_mage boolean_equals no}
                        [/show_if]
                        [command]
                            {FIRE_EVENT bonus_mage}
                            {VARIABLE v_bonus_mage yes}
                            {VARIABLE_OP selected_options sub 1}
                        [/command]
                    [/option]
                    [option]
                        label=_"some starting funds?"
                        [show_if]
                            {VARIABLE_CONDITIONAL v_bonus_funds boolean_equals no}
                        [/show_if]
                        [command]
                            {FIRE_EVENT bonus_funds}
                            {VARIABLE v_bonus_funds yes}
                            {VARIABLE_OP selected_options sub 1}
                        [/command]
                    [/option]
                    [option]
                        label=_"a rare artifact?"
                        [show_if]
                            {VARIABLE_CONDITIONAL v_bonus_artifact boolean_equals no}
                        [/show_if]
                        [command]
                            {FIRE_EVENT bonus_artifact}
                            {VARIABLE v_bonus_artifact yes}
                            {VARIABLE_OP selected_options sub 1}
                        [/command]
                    [/option]
                    [option]
                        label=_"a box of termites?"
                        [show_if]
                            {VARIABLE_CONDITIONAL v_bonus_termites boolean_equals no}
                        [/show_if]
                        [command]
                            {FIRE_EVENT bonus_termites}
                            {VARIABLE v_bonus_termites yes}
                            {VARIABLE_OP selected_options sub 1}
                        [/command]
                    [/option]
#ifndef HARD
                    [option]
                        label=_"treatises scrolls?"
                        [show_if]
                            {VARIABLE_CONDITIONAL v_bonus_treatises boolean_equals no}
                        [/show_if]
                        [command]
                            {FIRE_EVENT bonus_treatises}
                            {VARIABLE v_bonus_treatises yes}
                            {VARIABLE_OP selected_options sub 1}
                        [/command]
                    [/option]
#endif
#ifndef HARD
                    [option]
                        label=_"a book on finance?"
                        [show_if]
                            {VARIABLE_CONDITIONAL v_bonus_finance boolean_equals no}
                        [/show_if]
                        [command]
                            {FIRE_EVENT bonus_finance}
                            {VARIABLE v_bonus_finance yes}
                            {VARIABLE_OP selected_options sub 1}
                        [/command]
                    [/option]
#endif
                    [option]
                        label=_"a book on fungi?"
                        [show_if]
                            {VARIABLE_CONDITIONAL v_bonus_fungi boolean_equals no}
                        [/show_if]
                        [command]
                            {FIRE_EVENT bonus_fungi}
                            {VARIABLE v_bonus_fungi yes}
                            {VARIABLE_OP selected_options sub 1}
                        [/command]
                    [/option]
#ifndef HARD
                    [option]
                        label=_"some maps?"
                        [show_if]
                            {VARIABLE_CONDITIONAL v_bonus_maps boolean_equals no}
                        [/show_if]
                        [command]
                            {FIRE_EVENT bonus_maps}
                            {VARIABLE v_bonus_maps yes}
                            {VARIABLE_OP selected_options sub 1}
                        [/command]
                    [/option]
#endif

                    #[option]
                    #    label=_"a book about digging tunnels?"
                    #    [show_if]
                    #        {VARIABLE_CONDITIONAL v_bonus_tunnels boolean_equals no}
                    #    [/show_if]
                    #    [command]
                    #        {FIRE_EVENT bonus_tunnels}
                    #        {VARIABLE v_bonus_tunnels yes}
                    #        {VARIABLE_OP selected_options sub 1}
                    #    [/command]
                    #[/option]
                    #[option]
                    #    label=_"a book on castle wall fortifications?"
                    #    [show_if]
                    #        {VARIABLE_CONDITIONAL v_bonus_fortifications boolean_equals no}
                    #    [/show_if]
                    #    [command]
                    #        {FIRE_EVENT bonus_fortifications}
                    #        {VARIABLE v_bonus_fortifications yes}
                    #        {VARIABLE_OP selected_options sub 1}
                    #    [/command]
                    #[/option]

                    [option]
                        label=_"Nevermind, I don't need it. ($selected_options| left)"
                        [command]
                            {VARIABLE selected_options 0}
                        [/command]
                    [/option]
                [/message]
            [/do]
        [/while]

        {CLEAR_VARIABLE selected_options}

        {CLEAR_VARIABLE v_bonus_funds}
        {CLEAR_VARIABLE v_bonus_followers}
        {CLEAR_VARIABLE v_bonus_workers}
        {CLEAR_VARIABLE v_bonus_guardian}
        {CLEAR_VARIABLE v_bonus_mage}
        {CLEAR_VARIABLE v_bonus_prisoner}
        {CLEAR_VARIABLE v_bonus_artifact}
        {CLEAR_VARIABLE v_bonus_termites}
        {CLEAR_VARIABLE v_bonus_treatises}
        {CLEAR_VARIABLE v_bonus_finance}
        {CLEAR_VARIABLE v_bonus_fungi}
        {CLEAR_VARIABLE v_bonus_maps}
        {CLEAR_VARIABLE v_bonus_fortifications}
        {CLEAR_VARIABLE v_bonus_tunnels}

        {REMOVE_EVENT bonus_funds}
        {REMOVE_EVENT bonus_followers}
        {REMOVE_EVENT bonus_workers}
        {REMOVE_EVENT bonus_guardian}
        {REMOVE_EVENT bonus_mage}
        {REMOVE_EVENT bonus_prisoner}
        {REMOVE_EVENT bonus_artifact}
        {REMOVE_EVENT bonus_termites}
        {REMOVE_EVENT bonus_treatises}
        {REMOVE_EVENT bonus_finance}
        {REMOVE_EVENT bonus_fungi}
        {REMOVE_EVENT bonus_maps}
        {REMOVE_EVENT bonus_fortifications}
        {REMOVE_EVENT bonus_tunnels}

        {BEGINNING_TUTORIAL}

        [objectives]
            side=1
            [objective]
                condition=win
                description=_"Build a new wooden keep"
            [/objective]
            {OBJECTIVE_DONT_DIE}
            {OBJECTIVE_NO_BANKRUPTCY}
            [note]
                description=_"Right-click on your Hero to build a wooden keep."
            [/note]
            {NOTE_SEASON_YEAR}
        [/objectives]
        [show_objectives]
            side=1
        [/show_objectives]

        {DISPLAY_YEAR_AND _"Spring"}
    [/event]

    [event]
        name=bonus_funds
        id=bonus_funds
        first_time_only=yes

        {ADVISOR_SAYS _"Yes, indeed. Two hundred gold coins will go a long way towards securing these new lands."}
        [sound]
            name="gold.ogg"
        [/sound]
        [gold]
            side=1
            amount=200
        [/gold]
        {VARIABLE farm_income.spring 2}
        #{VARIABLE farm_support.spring 2}
        [modify_side]
            side=1
            village_gold=$farm_income.spring
            #village_support=$farm_support.spring
        [/modify_side]
    [/event]
    [event]
        name=bonus_followers
        id=bonus_followers
        first_time_only=yes

        {CYNIC_SAYS _"Indeed, but they seem to have gotten lost."}
        # Use types that can advance without buildings
        [unit]
            animate=yes
            id=loyal_peasant
            passable=yes
            placement=leader
            random_traits=no
            side=1
            type=WF_Peasant
            name=_"The Help"
            [modifications]
                {TRAIT_LOYAL}
                {TRAIT_INTELLIGENT}
            [/modifications]
            {IS_LOYAL}
        [/unit]
        [unit]
            animate=yes
            id=loyal_woodsman
            passable=yes
            placement=leader
            random_traits=no
            side=1
            type=WF_Woodsman
            name=_"The Help"
            [modifications]
                {TRAIT_LOYAL}
                {TRAIT_RESILIENT}
            [/modifications]
            {IS_LOYAL}
        [/unit]
        [unit]
            animate=yes
            id=loyal_ruffian
            passable=yes
            placement=leader
            random_traits=no
            side=1
            type=WF_Ruffian
            name=_"The Help"
            [modifications]
                {TRAIT_LOYAL}
                {TRAIT_STRONG}
            [/modifications]
            {IS_LOYAL}
        [/unit]
        [unit]
            animate=yes
            id=loyal_fencer
            passable=yes
            placement=leader
            random_traits=no
            side=1
            type=Fencer
            name=_"The Help"
            [modifications]
                {TRAIT_LOYAL}
                {TRAIT_INTELLIGENT}
            [/modifications]
            {IS_LOYAL}
        [/unit]
        {SPEAKER_SAYS loyal_peasant _"<i>*huff* *puff*</i> Sorry for being late, my lord!"}
    [/event]
    [event]
        name=bonus_workers
        id=bonus_workers
        first_time_only=yes

#ifndef HARD
        {WF_WORK_FASTER}
#endif
        {CYNIC_SAYS _"Indeed, but they seem to have gotten lost."}
        [unit]
            animate=yes
            id=loyal_worker
            passable=yes
            placement=leader
            random_traits=no
            side=1
            type=Peasant Workers
            name=_"The Workers"
            [modifications]
                {TRAIT_LOYAL}
                {TRAIT_QUICK}
            [/modifications]
            {IS_LOYAL}
        [/unit]
        [fire_event]
            name=amla_extra_event
            [primary_unit]
                id=loyal_worker
            [/primary_unit]
        [/fire_event]
        {SPEAKER_SAYS loyal_worker _"<i>(panting)</i> Sorry for being late, my lord. We promise to be hardworking."}
    [/event]
    [event]
        name=bonus_guardian
        id=bonus_guardian
        first_time_only=yes

#ifndef HARD
        [set_variable]
            name=wf_vars.extra_guardian
            value=1
        [/set_variable]
#endif
        {FOOL_SAYS _"Yes, I heard about that as well. But where are they? <i>(Looks around.)</i>"}
        [store_unit]
            variable=fool_store
            mode=always_clear
            kill=no
            [filter]
                role=fool
            [/filter]
        [/store_unit]
        [unit]
            animate=yes
            id=loyal_knight
            passable=yes
            placement=map
            random_traits=no
            side=1
            type=Grand Knight
            name=_"The Guardian"
            facing=se
            x,y=$fool_store.x,$fool_store.y
            [modifications]
                {TRAIT_LOYAL}
                {TRAIT_RESILIENT}
            [/modifications]
            {IS_LOYAL}
        [/unit]
        [fire_event]
            name=amla_extra_event
            [primary_unit]
                id=loyal_knight
            [/primary_unit]
        [/fire_event]
        [unit]
            animate=yes
            id=loyal_paladin
            passable=yes
            placement=leader
            random_traits=no
            side=1
            type=Paladin
            name=_"The Guardian"
            [modifications]
                {TRAIT_LOYAL}
                {TRAIT_RESILIENT}
            [/modifications]
            {IS_LOYAL}
        [/unit]
        [fire_event]
            name=amla_extra_event
            [primary_unit]
                id=loyal_paladin
            [/primary_unit]
        [/fire_event]
        [unit]
            animate=yes
            id=loyal_avenger
            passable=yes
            placement=leader
            random_traits=no
            side=1
            type=Elvish Avenger
            name=_"The Guardian"
            [modifications]
                {TRAIT_LOYAL}
                {TRAIT_DEXTROUS}
            [/modifications]
            {IS_LOYAL}
        [/unit]
        [fire_event]
            name=amla_extra_event
            [primary_unit]
                id=loyal_avenger
            [/primary_unit]
        [/fire_event]
        {SPEAKER_SAYS loyal_knight _"Right behind you."}
        {FOOL_SAYS _"Eek!"}
        {SPEAKER_SAYS loyal_knight _"Your vigilance is lacking lad. Better correct that before some rogue stabs you in the back."}
        {CLEAR_VARIABLE fool_store}
    [/event]
    [event]
        name=bonus_mage
        id=bonus_mage
        first_time_only=yes

        {FOOL_SAYS _"Yes, I heard about that as well. But where is she? <i>(Looks around.)</i>"}
        [store_unit]
            variable=fool_store
            mode=always_clear
            kill=no
            [filter]
                role=fool
            [/filter]
        [/store_unit]
        [unit]
            animate=yes
            gender=female
            id=loyal_mage
            passable=yes
            placement=map
            facing=se
            random_traits=no
            side=1
            type=Silver Mage
            name=_"Powerful Mage"
            x,y=$fool_store.x,$fool_store.y
            [modifications]
                {TRAIT_LOYAL}
                {TRAIT_QUICK}
            [/modifications]
            {IS_LOYAL}
        [/unit]
        [fire_event]
            name=amla_extra_event
            [primary_unit]
                id=loyal_mage
            [/primary_unit]
        [/fire_event]
        {SPEAKER_SAYS loyal_mage _"Right behind you."}
        {FOOL_SAYS _"Eek! Where did you come from?"}
        {CLEAR_VARIABLE fool_store}
        [modify_unit]
            [filter]
                id=Hero
                [not]
                    ability=teleport
                [/not]
            [/filter]
            [object]
                id="pickable_overlay"
                take_only_once=no
                [effect]
                    apply_to=overlay
                    add=misc/pickable-overlay.png
                [/effect]
            [/object]
            [object]
                name="Orb of Teleport"
                id="Orb of Teleport"
                image=items/ball-magenta.png
                description=_"This orb teleports the carrier between any two empty villages."
                take_only_once=no
                [effect]
                    apply_to=new_ability
                    [abilities]
                        {ABILITY_TELEPORT}
                    [/abilities]
                [/effect]
            [/object]
        [/modify_unit]
    [/event]
    [event]
        name=bonus_prisoner
        id=bonus_prisoner
        first_time_only=yes

#ifndef HARD
        [set_variable]
            name=wf_vars.prisoner_bonus
            value=1
        [/set_variable]
#endif
        {CYNIC_SAYS _"Yes, I heard about that as well. But where is she? <i>(Looks around.)</i>"}
        [unit]
            animate=yes
            id=bonus_caravan
            name=_"Turnip Cart"
            passable=yes
            placement=leader
            random_traits=no
            side=1
            type=Caravan
            [modifications]
                {TRAIT_LOYAL}
            [/modifications]
            {IS_LOYAL}
        [/unit]
        [store_unit]
            variable=caravan_store
            mode=always_clear
            kill=no
            [filter]
                id=bonus_caravan
            [/filter]
        [/store_unit]
        {SPEAKER_SAYS bonus_caravan _"Sorry, we got held up in traffic. I suspect my passenger had something to do with that."}
        {SPEAKER_SAYS bonus_caravan _"Beware milord, this one is a troublemaker. Your father was eager in kicking her out of the city."}
        [unit]
            animate=yes
            gender=female
            id=loyal_adept
            name=_"Ardonna"
            passable=yes
            placement=map
            random_traits=no
            side=1
            type=Dark Adept
            x,y=$caravan_store.x,$caravan_store.y
            [status]
                norecall=yes
            [/status]
            [modifications]
                {TRAIT_LOYAL}
                {TRAIT_QUICK}
            [/modifications]
            {IS_LOYAL}
        [/unit]
        [kill]
            side=1
            animate=no
            id=bonus_caravan
            fire_event=no
        [/kill]
        {CLEAR_VARIABLE caravan_store}
        {HERO_SAYS _"And, what were you in for?"}
        {SPEAKER_SAYS loyal_adept _"I plead the 5th."}
    [/event]
    [event]
        name=bonus_artifact
        id=bonus_artifact
        first_time_only=yes

#ifndef HARD
        [set_variable]
            name=wf_vars.armor_caravan
            value=yes
        [/set_variable]
#endif
        {ADVISOR_SAYS _"Lo, it arrives now."}
        [unit]
            animate=yes
            id=bonus_caravan
            name=_"Peddler Wagon"
            passable=yes
            placement=leader
            random_traits=no
            side=1
            type=Caravan
            [modifications]
                {TRAIT_LOYAL}
            [/modifications]
            {IS_LOYAL}
        [/unit]

        {WF_MARKET_ITEMS}
        #market=starting bonus 1 | caravan market 2 | disabled not for sale 3 | filler 4
        {WF_MARKET_ITEMS_APPEND_MARKET bonus_market_items 1}
        {WF_MARKET_ITEMS_RANDOM_INDEX bonus_market_items rnd_i1 rnd_label1}
        {WF_MARKET_ITEMS_RANDOM_INDEX bonus_market_items rnd_i2 rnd_label2}
        {WF_MARKET_ITEMS_RANDOM_INDEX bonus_market_items rnd_i3 rnd_label3}
        [set_variables]
            name=market.offered_items
            mode=append
            {VALUE1 index $rnd_i1}
            {VALUE1 index $rnd_i2}
            {VALUE1 index $rnd_i3}
        [/set_variables]
        {CLEAR_VARIABLE bonus_market_items}
        {CLEAR_VARIABLE wf_market_items}

        {SPEAKER_SAYS bonus_caravan _"You may have one of these:
$rnd_label1|.
$rnd_label2|.
$rnd_label3|."}

        [store_unit]
            variable=caravan_store
            mode=always_clear
            kill=no
            [filter]
                id=bonus_caravan
            [/filter]
        [/store_unit]
        [fire_event]
            name=wf_market
            [primary_unit]
                x=$caravan_store.x|
                y=$caravan_store.y|
            [/primary_unit]
            #[secondary_unit]
            #	x=$x2
            #	y=$y2
            #[/secondary_unit]
            [primary_attack]
                index1=$rnd_i1|
                label1=$rnd_label1|
                price1=0
                pay1=0

                index2=$rnd_i2|
                label2=$rnd_label2|
                price2=0
                pay2=0

                index3=$rnd_i3|
                label3=$rnd_label3|
                price3=0
                pay3=0

                x=$caravan_store.x|
                y=$caravan_store.y|
            [/primary_attack]
        [/fire_event]
        [kill]
            side=1
            animate=no
            id=bonus_caravan
            fire_event=no
        [/kill]
        {CLEAR_VARIABLE rnd_i1}
        {CLEAR_VARIABLE rnd_label1}
        {CLEAR_VARIABLE rnd_i2}
        {CLEAR_VARIABLE rnd_label2}
        {CLEAR_VARIABLE rnd_i3}
        {CLEAR_VARIABLE rnd_label3}
        {CLEAR_VARIABLE caravan_store}
    [/event]
    [event]
        name=bonus_termites
        id=bonus_termites
        first_time_only=yes
        {ADVISOR_SAYS _"Unleashing these hungry termites will clear the surrounding forest and hills."}
        [store_unit]
            variable=hero_store
            mode=always_clear
            kill=no
            [filter]
                id=Hero
            [/filter]
        [/store_unit]
        [terrain]
            [and]
                terrain=!,*^V*,!,Hh^*
                [and]
                    x,y=$hero_store.x,$hero_store.y
                    radius=9
                [/and]
            [/and]
            terrain=Gg^Es
        [/terrain]
        [sound]
            name=cave-in.ogg
        [/sound]
        {FOOL_SAYS _"Ah! Get them off me!"}
        [harm_unit]
            [filter]
                role=fool
            [/filter]
            amount=2
            kill=no
            animate=yes
        [/harm_unit]
        [terrain]
            [and]
                terrain=!,*^V*,!,*^F*
                [and]
                    x,y=$hero_store.x,$hero_store.y
                    radius=9
                [/and]
            [/and]
            terrain=Gg^Em
        [/terrain]
        [sound]
            name="wose-die.ogg"
        [/sound]
        {HERO_SAYS _"<i>(swatting)</i> Stand still!"}
        {CYNIC_SAYS _"Haha, they couldn't tell the difference between you and a log."}
        {FOOL_SAYS _"It's not funny!"}
        [harm_unit]
            [filter]
                role=fool
            [/filter]
            amount=2
            kill=no
            animate=yes
        [/harm_unit]
        {ADVISOR_SAYS _"Eat some mushrooms, they will make you feel better."}
        # Remove water, swamp, mountains near center (radius 9)
        [terrain]
            [and]
                terrain=!,*^V*,!,Ww^*,Ss^*,Sm^*
                [and]
                    x,y=$hero_store.x,$hero_store.y
                    radius=9
                [/and]
            [/and]
            terrain=Gg^Em
        [/terrain]
        [sound]
            name=water-blast.wav
        [/sound]
        {CYNIC_SAYS _"These termites just drank up a lake!"}
        # Clear path from center to edge
        [terrain]
            [and]
                terrain=!,*^V*,!,Mm^*
                [and]
                    x,y=$hero_store.x,$hero_store.y
                    radius=9
                [/and]
            [/and]
            terrain=Gg^Es
        [/terrain]
        [terrain]
            [and]
                terrain=!,*^V*,!,Mm^*,Hh^*,Ww^*,Ss^*,Sm^*,*^F*
                [and]
                    x=$hero_store.x
                    y=1-{MAP_HEIGHT}
                    radius=2
                [/and]
            [/and]
            terrain=Gg^Em
        [/terrain]
        [terrain]
            [and]
                terrain=!,*^V*,!,Mm^*,Hh^*,Ww^*,Ss^*,Sm^*,*^F*
                [and]
                    x=1-{MAP_WIDTH}
                    y=$hero_store.y
                    radius=2
                [/and]
            [/and]
            terrain=Gg^Em
        [/terrain]
        [sound]
            name=rumble.ogg
        [/sound]
        {FOOL_SAYS _"Did they just take down that mountain yonder?!"}
        {HERO_SAYS _"Those were some hungry termites. Good thing I didn't keep them in my pouch."}
        {CLEAR_VARIABLE hero_store}
    [/event]
    [event]
        name=bonus_treatises
        id=bonus_treatises
        first_time_only=yes

        [set_variable]
            name=wf_vars.law_book
            value=2
        [/set_variable]
        {ADVISOR_SAYS _"Yes, here you go."}
        {HERO_SAYS _"<i>(puzzled)</i> What does my father expect me to do with these?"}
        {ADVISOR_SAYS _"I am sure he had a reason. You best read them carefully."}
    [/event]
    [event]
        name=bonus_finance
        id=bonus_finance
        first_time_only=yes

        {ADVISOR_SAYS _"Yes, here you go. This book will reduce project costs."}
        [set_variable]
            name=wf_vars.finance_book
            value=yes
        [/set_variable]
        [set_variables]
            name=proj_costs
            mode=replace
            [value]
                {COST_DISCOUNT}
            [/value]
        [/set_variables]
    [/event]
    [event]
        name=bonus_fungi
        id=bonus_fungi
        first_time_only=yes

        [set_variable]
            name=wf_vars.fungi_book
            value=4
        [/set_variable]
        [set_variable]
            name=wf_vars.eating_cost
            value=2
        [/set_variable]
        {ADVISOR_SAYS _"This book will help us get the most out of mushrooms."}
        {FIRE_EVENT eat_mushrooms1}
    [/event]
    [event]
        name=bonus_maps
        id=bonus_maps
        first_time_only=yes

        {ADVISOR_SAYS _"Our scouts took good care in canvasing the landscape."}
        [set_variable]
            name=wf_vars.no_fog
            value=yes
        [/set_variable]
        [remove_shroud]
            [filter_side]
                side=1
            [/filter_side]
            {X_AND_Y_ARE_ON_THE_MAP}
            #x="$({BORDER})"-"$({MAP_WIDTH}-{BORDER})"
            #y="$({BORDER})"-"$({MAP_HEIGHT}-{BORDER})"
        [/remove_shroud]
        [redraw]
            side=1
            clear_shroud=yes
        [/redraw]
        [modify_side]
            side=1
            fog=no
            shroud=no
        [/modify_side]
    [/event]
    [event]
        name=bonus_fortifications
        id=bonus_fortifications
        first_time_only=yes

        {ADVISOR_SAYS _"This book teaches how to build unscalable castle walls."}
        [set_variable]
            name=wf_vars.unwalkable_castle
            value=yes
        [/set_variable]
    [/event]
    [event]
        name=bonus_tunnels
        id=bonus_tunnels
        first_time_only=yes

        {ADVISOR_SAYS _"This book teaches how to dig bi-directional tunnels."}
        [set_variable]
            name=wf_vars.bidirectional_tunnel
            value=yes
        [/set_variable]
    [/event]

    # ----- In-scenario Events -------------------------------------------
    {LOW_GOLD_WARNINGS}
    {TUTORIAL_MESSAGES}
    {GENERIC_DIALOGUE}
    {LOYAL_AMLA}

    [event]
        name=new turn
        id=gradual_change
        [filter_condition]	# done this way so I can do math on the turn number
            [variable]
                name=turn_number
                numerical_equals="$({SEASON_LENGTH}-2)"
            [/variable]
        [/filter_condition]

        {END_OF_BEGINNING}

        {WF_RANDOM_PLACEMENT Mm Md}
        {WF_RANDOM_PLACEMENT Gg Gs}
        {STOP_ENEMY_SPAWN}
    [/event]

    # ----- Defeat & Victory Conditions ----------------------------------
    # These are added to once you build your keep
    {DEFEAT_HERO_DIES}
    {DEFEAT_BANKRUPTCY}

    {END_OF_SEASON}
    {CAMPAIGN_VICTORY}	# This needs to be here for the gold check

    # ----- Clean-up -----------------------------------------------------
    [event]
        name=wf_victory

        {VARIABLE wf_vars.attack_animals no}

        [fire_event]
            name=place_recall_list
        [/fire_event]

        # Outlaw band size back to normal
        {VARIABLE_OP enemy.num_outlaws add 1}

        {CLEAR_VARIABLE quota}
        {STORE_MAP_AND_UNITS}
        {WF_CLEANUP_MENU}
        {CLEAR_VARIABLE last_unit_id}
    [/event]

    {WF_DEBUG_NEXT_LEVEL}
    {WF_RAND_CHOICE_EVENT}
    {WF_DIPLOMACY}
    {WF_MISC_EVENTS}
    {WF_SEASON_DEBUG spring}
[/scenario]
